generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String    @unique
  passwordHash String    @map("password_hash")
  name         String?
  role         String?   @default("user")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  posts        Post[]

  @@index([email], map: "idx_users_email")
  @@map("users")
}

model Post {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title           String
  excerpt         String?
  content         String
  featuredImage   String?           @map("featured_image")
  authorId        String            @map("author_id") @db.Uuid
  status          String?           @default("draft")
  readTime        Int?              @default(5) @map("read_time")
  createdAt       DateTime?         @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  tableOfContents Json?             @default("[]") @map("table_of_contents")
  post_tags       PostTag[]
  translations    PostTranslation[]
  author          User              @relation(fields: [authorId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([authorId], map: "idx_posts_author_id")
  @@index([createdAt(sort: Desc)], map: "idx_posts_created_at")
  @@index([status], map: "idx_posts_status")
  @@map("posts")
}

model PostTranslation {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  postId    String    @map("post_id") @db.Uuid
  locale    String    @db.VarChar(5)
  title     String
  excerpt   String?
  content   String
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  post      Post      @relation(fields: [postId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([postId, locale])
  @@index([locale], map: "idx_post_translations_locale")
  @@index([postId], map: "idx_post_translations_post_id")
  @@index([postId, locale], map: "idx_post_translations_post_locale")
  @@map("post_translations")
}

model Tag {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String    @unique
  slug      String    @unique
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  post_tags PostTag[]

  @@map("tags")
}

model PostTag {
  post_id String @db.Uuid
  tag_id  String @db.Uuid
  posts   Post   @relation(fields: [post_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tags    Tag    @relation(fields: [tag_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([post_id, tag_id])
  @@index([post_id], map: "idx_post_tags_post_id")
  @@index([tag_id], map: "idx_post_tags_tag_id")
  @@map("post_tags")
}
